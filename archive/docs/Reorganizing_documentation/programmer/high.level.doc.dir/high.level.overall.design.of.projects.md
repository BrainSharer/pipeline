## Organization of the pipeline code

The goal of this document is to specify the design of the software
used to prepare, organize, align, visualize and annotate brain section stacks.

The code include interfaces to an RDBMS and to a web-based image
browser (Neuroglancer)

The code resides in a directory called `pipeline`

This code does **not** include:
* Machine learning code.
* Code for detecting brain structures.
* Code for detecting marked cells.

### Library files vs. scripts 
There are two types `Python` files (files with the extension `.py`),
`scripts` and `modules` or `libraries`

Files of the first type are meant to run from the command line. In
other words, they can be used by a non-programmer. We say that scripts
are `user facing`.
Scripts can accept parameters, the parameters for a script are documented in te script
using the `argparse` library.

On the other hand, scripts are hidden from the user and the command
line. They can only be used by being `imported` into another python file.

### Integration into pipeline
script files should conform to the api expected by the database, and
be tested against the database.

**Yoav** This is documentation, not a set of directives, and I think
   that the link between the code and the RDBMS should be
   weak. however, assuming we sticck to this
   design, this should be explained in detail so that a new programmer
   can add/change scripts. This would probably involve some
   documentaation of `django` and of `controllers`.


## Main modules

## Current documentation for some of the models 
The following lines taken from the README.md file

1. Classes
    1. [Atlas class](../Atlas.Class.md)  one line
    1. [Cell dectector class](../cell_detection/CellDetector.Class.md)  Several one-line sections
    1. [Django class](https://activebrainatlasadmin.readthedocs.io)  Uses automatic documentation generation - the gold standard.
    1. [Pipeline class](../Pipeline.Class.md) One line

of these only the Django Class points to extensive documentation, generated by Ed using readthedocs. (see the definition of the orgamization [here](https://github.com/ActiveBrainAtlas2/activebrainatlasadmin/blob/master/docs/source/index.rst).
The rest are one line descriptions that explain very little.

Each of the following modules should be explained

* Controllers
* Controllers/test
* Plotter
* atlas
* atlas/save_folder
* atlas/tests
* masking
* model
* transformation
* utilities - there are many files here
* in_development - temporary home

The following modules should move to a separate directory
* cell_density
* cell_extractor
* registration


## Lucidchart diagrams
* [workflow](https://lucid.app/lucidchart/invitations/accept/inv_0534f70f-378d-4708-bbae-056f1aa7d3b3)
* [Data Organization](https://lucid.app/lucidchart/invitations/accept/inv_9d5af939-c120-46a5-b6da-649119d54ffe)

